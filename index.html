<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kontrola žetona</title>
<link rel="stylesheet" href="user-app-styles.css">
</head>
<body>

<!-- 🎮 Animation Container -->
<div class="animation-container" id="animationContainer"></div>

<div class="card" id="loginBox">
  <h2>🔑 Prijava</h2>
  
  <!-- Step 1: Company Selection -->
  <div class="login-step" id="step1">
    <input type="text" id="firmaName" placeholder="Ime firme" autocomplete="off">
    <h3>Unesi PIN firme</h3>
    <div class="pin-dots">
      <div id="companyDot1"></div>
      <div id="companyDot2"></div>
      <div id="companyDot3"></div>
      <div id="companyDot4"></div>
    </div>
    <div class="pin-pad">
      <button onclick="pressCompanyPin('1')">1</button>
      <button onclick="pressCompanyPin('2')">2</button>
      <button onclick="pressCompanyPin('3')">3</button>
      <button onclick="pressCompanyPin('4')">4</button>
      <button onclick="pressCompanyPin('5')">5</button>
      <button onclick="pressCompanyPin('6')">6</button>
      <button onclick="pressCompanyPin('7')">7</button>
      <button onclick="pressCompanyPin('8')">8</button>
      <button onclick="pressCompanyPin('9')">9</button>
      <button class="clear" onclick="clearCompanyPin()">⌫</button>
      <button onclick="pressCompanyPin('0')">0</button>
      <button class="ok" onclick="submitCompanyPin()">OK</button>
    </div>
    <div class="status" id="companyStatus"></div>
  </div>

  <!-- Step 2: User Selection -->
  <div class="login-step hidden" id="step2">
    <div class="user-selection">
      <h3>👤 Izaberi korisnika</h3>
      <select id="userSelect">
        <option value="">-- Izaberi korisnika --</option>
      </select>
      <p>ili</p>
      <input type="text" id="userName" placeholder="Upiši ime korisnika" autocomplete="off">
      <h3>Unesi PIN korisnika</h3>
      <div class="pin-dots">
        <div id="userDot1"></div>
        <div id="userDot2"></div>
        <div id="userDot3"></div>
        <div id="userDot4"></div>
      </div>
      <div class="pin-pad">
        <button onclick="pressUserPin('1')">1</button>
        <button onclick="pressUserPin('2')">2</button>
        <button onclick="pressUserPin('3')">3</button>
        <button onclick="pressUserPin('4')">4</button>
        <button onclick="pressUserPin('5')">5</button>
        <button onclick="pressUserPin('6')">6</button>
        <button onclick="pressUserPin('7')">7</button>
        <button onclick="pressUserPin('8')">8</button>
        <button onclick="pressUserPin('9')">9</button>
        <button class="clear" onclick="clearUserPin()">⌫</button>
        <button onclick="pressUserPin('0')">0</button>
        <button class="ok" onclick="submitUserPin()">OK</button>
      </div>
      
      <!-- NEW: Admin Login Option -->
      <div class="admin-login-option">
        <p>ili</p>
        <button class="admin-login-btn" onclick="showAdminLogin()">
          👑 Admin Dashboard
        </button>
      </div>
    </div>
    <div class="status" id="userStatus"></div>
  </div>

  <!-- NEW: Admin Login Step -->
  <div class="login-step hidden" id="adminStep">
    <div class="admin-login-section">
      <h3>👑 Admin Dashboard</h3>
      <p>Unesi admin PIN za firmu</p>
      <div class="pin-dots">
        <div id="adminDot1"></div>
        <div id="adminDot2"></div>
        <div id="adminDot3"></div>
        <div id="adminDot4"></div>
      </div>
      <div class="pin-pad">
        <button onclick="pressAdminPin('1')">1</button>
        <button onclick="pressAdminPin('2')">2</button>
        <button onclick="pressAdminPin('3')">3</button>
        <button onclick="pressAdminPin('4')">4</button>
        <button onclick="pressAdminPin('5')">5</button>
        <button onclick="pressAdminPin('6')">6</button>
        <button onclick="pressAdminPin('7')">7</button>
        <button onclick="pressAdminPin('8')">8</button>
        <button onclick="pressAdminPin('9')">9</button>
        <button class="clear" onclick="clearAdminPin()">⌫</button>
        <button onclick="pressAdminPin('0')">0</button>
        <button class="ok" onclick="confirmAdminPin()">OK</button>
      </div>
      <button class="back-btn" onclick="backToUserLogin()">← Nazad</button>
    </div>
  </div>
</div>

<div class="card hidden" id="appBox">
  <h1 id="welcomeText"></h1>
  
  <div class="credit-info">
    <div><strong>Krediti firme:</strong></div>
    <div class="credits-display" id="creditsCount">0</div>
    <div class="spending-info" id="spendingInfo"></div>
  </div>
  
  <!-- NEW: Box Selection -->
  <div class="box-selection">
    <h3>🚗 Izaberi box za pranje</h3>
    <div class="box-cards">
      <div class="box-card" onclick="selectBox('box2')" id="box2Card">
        <div class="box-icon">🚗</div>
        <div class="box-name">Box 2</div>
      </div>
      <div class="box-card" onclick="selectBox('box3')" id="box3Card">
        <div class="box-icon">🚗</div>
        <div class="box-name">Box 3</div>
      </div>
    </div>
  </div>
  
  <div class="counter">
    <button onclick="decrease()">-</button>
    <div class="number" id="tokenCount">0</div>
    <button onclick="increase()">+</button>
  </div>
  
  <div class="manual-input">
    <input type="number" id="manualTokens" placeholder="Upiši broj žetona" oninput="manualChange()" min="0">
  </div>
  
  <button class="send-btn" id="sendBtn" onclick="sendTokens()">Pošalji žetone</button>
  <button class="logout-btn" onclick="logout()">Odjavi se</button>
  
  <div class="status" id="status"></div>
  
  <div class="spending-history" id="spendingHistory">
    <h4>📊 Istorija potrošnje</h4>
    <div id="historyList"></div>
  </div>
</div>

<!-- NEW: Admin Dashboard -->
<div class="card hidden" id="adminDashboard">
  <h1>👑 Admin Dashboard</h1>
  <div class="admin-header">
    <div class="admin-info">
      <h3>🏢 <span id="adminFirmaName">Firma</span></h3>
      <p>Admin Panel - Monitoring potrošnje</p>
    </div>
    <button class="logout-btn" onclick="adminLogout()">Odjavi se</button>
  </div>
  
  <!-- Admin Controls -->
  <div class="admin-controls">
    <div class="control-group">
      <label>🔍 Pretraga:</label>
      <input type="text" id="adminSearch" placeholder="Pretraži po imenu korisnika..." oninput="filterAdminData()">
    </div>
    <div class="control-group">
      <label>📅 Period:</label>
      <select id="adminPeriod" onchange="filterAdminData()">
        <option value="all">Sve</option>
        <option value="today">Danas</option>
        <option value="week">Ova nedelja</option>
        <option value="month">Ovaj mesec</option>
      </select>
    </div>
    <div class="control-group">
      <label>📊 Sortiraj po:</label>
      <select id="adminSort" onchange="filterAdminData()">
        <option value="time">Vremenu</option>
        <option value="amount">Količini</option>
        <option value="name">Imenu</option>
      </select>
    </div>
  </div>
  
  <!-- Admin Statistics -->
  <div class="admin-stats">
    <div class="stat-card">
      <div class="stat-icon">👥</div>
      <div class="stat-content">
        <div class="stat-number" id="adminTotalEmployees">0</div>
        <div class="stat-label">Ukupno zaposlenih</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">💸</div>
      <div class="stat-content">
        <div class="stat-number" id="adminTotalTokens">0</div>
        <div class="stat-label">Ukupno kredita</div>
        <div class="stat-rsd" id="adminTotalRSD">0 RSD</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">🚗</div>
      <div class="stat-content">
        <div class="stat-number" id="adminTotalWashes">0</div>
        <div class="stat-label">Ukupno pranja</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">📊</div>
      <div class="stat-content">
        <div class="stat-number" id="adminAveragePerEmployee">0</div>
        <div class="stat-label">Prosečno po zaposlenom</div>
        <div class="stat-rsd" id="adminAverageRSD">0 RSD</div>
      </div>
    </div>
  </div>
  
  <!-- Admin Table -->
  <div class="admin-table-container">
    <h3>📋 Pregled potrošnje po korisnicima (1 kredit = 100 RSD)</h3>
    <div class="table-controls">
      <button class="export-btn" onclick="exportAdminData()">📊 Export CSV sa detaljima</button>
      <button class="refresh-btn" onclick="refreshAdminData()">🔄 Osveži</button>
    </div>
    <div class="admin-table-wrapper">
      <table class="admin-table" id="adminTable">
        <thead>
          <tr>
            <th>👤 Korisnik</th>
            <th>💸 Ukupno kredita</th>
            <th>💰 Ukupno RSD</th>
            <th>🚗 Poslednji box</th>
            <th>📅 Poslednje pranje</th>
            <th>🔍 Detalji</th>
          </tr>
        </thead>
        <tbody id="adminTableBody">
          <!-- Data will be populated here -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="user-app-animations.js"></script>
</body>
</html>
